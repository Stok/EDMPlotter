<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <title>Experiment Control Panel</title>
    <link rel="stylesheet" type="text/css" href="css/containerstyle.css">
    <link rel="stylesheet" type="text/css" href="css/controlpanelstyle.css">
    <link rel="stylesheet" type="text/css" href="css/d3plotstyle.css">
</head>
<body>
    <div class="controlpanel">
        <input type="button" id="startbutton" value="Start" />
        <input type="button" id="stopbutton" value="Stop" />
        <input type="button" id="clearbutton" value="Clear" />
        <input type="button" id="savedatabutton" value="Save to" />
        <input type="text" id="savepathtextbox" value="C:\data\data.csv" />
    </div>
    <div class="controlpanel">

       <form name="ExpParams" id="ExpParams">
           Auto-trigger:<br>
           <select name="AutoStart" id="AutoStart">
            <option>false</option>
            <option>true</option>
           </select>
            <br>
           Number of points:<br>
           <input type="text" name="NumberOfPoints" id="NumberOfPoints" value="1000"><br>
           Sample rate:<br>
           <input type="text" name="SampleRate" id="SampleRate" value="200"><br>
       </form>

        </div>
    <div class="container">
        <svg id="plot" width="1000" height="500"></svg>
    </div>  

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-2.2.3.min.js" ></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Reference to d3 library-->
    <script charset="utf-8" type="text/javascript" src="Scripts/d3.v3.min.js"></script>
    <!--<script src="http://d3js.org/d3.v3.js"></script>-->
    <!--Add script to plot some data.-->
    <script src="js/d3plot.js" type="text/javascript"></script>
    <script type="text/javascript">
        
        //These control the server's data-pushing down to the client.
        $(function () {
            // Declare a proxy to reference the hub. 
            var pHub = $.connection.plotHub;

            // Create a function that the hub can call to plot the data.
            pHub.client.pushData = function (data) {
                //I am assuming that there is an svg object with id="plot". If there isn't, this will fail.
                plotData("#" + "plot", JSON.parse(data));
            };

            pHub.client.clearData = function () {
                clearData("#" + "plot");
            }


                    // Start the connection, and start plotting!
            $.connection.hub.start().done(function () {

                $('#startbutton').click(function () {

                    var params = {
                        'NumberOfPoints': document.querySelector('#NumberOfPoints').value,
                        'AINames': ['x_val', 'dc', '1f', '2f'],
                        'AIAddresses': ['/dev1/ai1', '/dev1/ai2', '/dev1/ai3', '/dev1/ai4'],
                        'AutoStart': document.querySelector('#AutoStart').value, 
                        'TriggerAddress': '/dev1/PFI0',
                        'SampleRate': document.querySelector('#SampleRate').value
                    };

                    //alert(JSON.stringify(params));
                    // Call the Start method on the hub. 
                    pHub.server.start(JSON.stringify(params));

                });
                    // Stop plotting
                $('#stopbutton').click(function () {
                    // Call the Stop method on the hub. 
                    pHub.server.stop();

                });
                
                    //Clears Plot
                $('#clearbutton').click(function () {
                    // Call the StopPlotting method on the hub. 
                    pHub.server.clearAll();

                });

                $('#savedatabutton').click(function () {
                    pHub.server.save($('#savepathtextbox').val());
                });


            });
            
        });
    </script>
</body>
</html>